services:
  unvanq-server:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        UNV_VERSION: "0.55.5"
        UNV_ARCH: "linux-arm64"
    platform: linux/arm64
    container_name: unvanq-server
    restart: unless-stopped
    environment:
      UNV_HOME: /var/unvanquished-home
      UNV_PORT: 27960
      UNV_PORT6: 27960
      UNV_SERVER_CFG: server.cfg
      # Prevent heartbeats to the Unvanquished master so the server stays unlisted when using LocalXpose
      UNV_DISABLE_MASTERS: "true"
    volumes:
      - unvanq-home:/var/unvanquished-home
    expose:
      - "27960/udp"

  localxpose:
    build:
      context: ./localxpose
      dockerfile: Dockerfile
    container_name: unvanq-localxpose
    restart: unless-stopped
    environment:
      # Set this in your shell or .env: LOCALXPOSE_ACCESS_TOKEN=xxxx
      LOCALXPOSE_ACCESS_TOKEN: "${LOCALXPOSE_ACCESS_TOKEN}"
      LOCALXPOSE_TO: "unvanq-server:27960"
      # Optional: LOCALXPOSE_REGION=eu, LOCALXPOSE_PORT=27960, LOCALXPOSE_RESERVED_ENDPOINT=us.loclx.io:27960
    depends_on:
      - unvanq-server
    expose:
      - "4040/tcp"

  webui:
    build:
      context: ./webui
      dockerfile: Dockerfile
    container_name: unvanq-webui
    restart: unless-stopped
    environment:
      # Where the Flask app should query the game server
      UNV_SERVER_HOST: unvanq-server
      UNV_SERVER_PORT: 27960

      # LocalXpose status API inside the Docker network
      LOCALXPOSE_STATUS_URL: http://unvanq-localxpose:4040/status
    depends_on:
      - unvanq-server
      - localxpose
    # Expose the web dashboard to your LAN
    ports:
      - "8080:8080"
    volumes:
      - webui-dashboard:/data

volumes:
  unvanq-home: {}
  webui-dashboard: {}
